<html>
  <script src="https://d3js.org/d3.v5.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/d3-annotation/2.5.1/d3-annotation.min.js"></script>
  <style>
    h1 {
      color: black;
      font-family: "Raleway", sans-serif;
      font-size: 24;
      font-weight: 800;
      line-height: 36px;
      margin: 0 100px 0px 100px;
      text-align: center;
      text-transform: uppercase;
    }
    circle {
      fill: lightblue;
      stroke: black;
    }
    svg text {
      fill: black;
      font: 15px sans-serif;
      text-anchor: center;
    }
  </style>
  <body onload="main()">
    <form>
      <form>
        <button formaction="/index.html">Firearms in the Household</button> >
        <button formaction="/mass.html">Mass Shootings over Time</button> >
        <button formaction="/lethality.html">
          The Effects of Firearm Restrictions
        </button>
      </form>
    </form>
    <h1 id="chart_title"></h1>
    <br />

    <div>
      <button id="plot_killed">Number of Victims Killed</button>
      <button id="plot_injured">Number of Victims Injured</button>
      <button id="plot_all">All Victims</button>
    </div>

    <svg width="600" height="400"></svg>

    <!-- <select id="selectOutcome"></select> -->
    <!-- <p id="demo">Click me.</p> -->
    <script>
      async function main() {
        var width = 600;
        var height = 400;
        var margin = 50;

        var outcome = "killed";

        document.getElementById("plot_all").addEventListener("click", plot_all);
        document.getElementById("chart_title").innerHTML =
          "Number of People Killed in Mass Shootings each Decade";
        document
          .getElementById("plot_killed")
          .addEventListener("click", plot_killed);

        document
          .getElementById("plot_injured")
          .addEventListener("click", plot_injured);

        function plot_all() {
          outcome = "all";
          document.getElementById("chart_title").innerHTML =
            "Number of All Victims in Mass Shootings each Decade";
          drawGraph(data_all);
        }

        function plot_killed() {
          outcome = "killed";
          document.getElementById("chart_title").innerHTML =
            "Number of People Killed in Mass Shootings each Decade";
          drawGraph(data_killed);
        }

        function plot_injured() {
          document.getElementById("chart_title").innerHTML =
            "Number of People Injured in Mass Shootings each Decade";
          outcome = "injured";
          drawGraph(data_injured);
        }

        // document.getElementById("selectYear").onchange = yearSelected;

        const data_killed = await d3.csv(
          "/data/decade_killed.csv",
          d3.autoType
        );

        const data_injured = await d3.csv(
          "/data/decade_injured.csv",
          d3.autoType
        );
        const data_all = await d3.csv("/data/decade_all.csv", d3.autoType);

        // document.getElementById("plot_all").onclick = drawGraph(data_all);
        document
          .getElementById("plot_all")
          .addEventListener("click", clearGraph());

        function clearGraph() {
          d3.selectAll("rect").remove();
          d3.select(".annotations").remove();
        }
        drawGraph(data_killed);

        function drawGraph(data) {
          clearGraph();
          //   console.log("outcome type: ", outcomeType);
          console.log(data);
          t2x = d3
            .scaleBand()
            .domain(["1970s", "1980s", "1990s", "2000s", "2010s"])
            .range([0, width])
            .padding(0.4);
          t2y = d3.scaleLinear().domain([0, 2000]).range([height, 0]);

          const annotations = [
            {
              note: {
                label:
                  "Numbers of mass shooting victims increase dramatically in 2010",
              },
              x: 450,
              y: 100,
              dy: 100,
              dx: -100,
              type: d3.annotationCalloutElbow,
              connector: { end: "arrow" },
            },
          ];

          const makeAnnotations = d3
            .annotation()
            .annotations(annotations)
            .type(d3.annotationCalloutCircle);

          svg = d3
            .select("svg")
            .attr("width", width + 2 * margin)
            .attr("height", height + 2 * margin)
            .append("g")
            .attr("transform", "translate(" + margin + "," + margin + ")")
            .selectAll()
            .data(data)
            .enter()
            .append("rect")
            .attr("class", "bar")
            // .filter(function (d) {
            //   return d.Year == year;
            // })
            .attr("x", function (d) {
              return t2x(d.decade);
            })
            .attr("y", function (d) {
              return t2y(d.count);
            })
            .attr("width", t2x.bandwidth())
            .attr("height", function (d) {
              return height - t2y(d.count);
            })
            // .attr("r", function (d) {
            //   return 5;
            // })
            .append("title")
            .text(function (d) {
              return d.count;
            });
          d3.select("svg")
            .append("g")
            .attr("transform", "translate(" + margin + "," + margin + ")")
            .call(d3.axisLeft(t2y));

          d3.select("svg")
            .append("g")
            .attr(
              "transform",
              "translate(" + margin + "," + (height + margin) + ")"
            )
            .call(d3.axisBottom(t2x));

          d3.select("svg")
            .append("g")
            .attr("id", "label_year")
            .attr("transform", "translate(" + margin + "," + margin + ")")
            .call(makeAnnotations);
        }

        // drawSelectOutcome();
        // drawGraph(data_all);
      }
    </script>

    <!-- <select name="outcomes" id="outcomes">
        <option value="killed">Number Killed</option>
        <option value="injured">Number Injured</option>
        <option value="all">All Victims</option>
      </select> -->
  </body>
</html>

<!-- var timespan = d3.extent(data.year);

xYear = d3
  .scaleTime()
  .domain([new Date(1980, 0, 1), new Date(2016, 0, 1)])
  .range([20, width - 20]); -->

<!-- .call(d3.axisBottom(xYear).tickFormat(d3.timeFormat("%Y"))); -->

<!-- .tickValues([0, 150, 50, 600])
  .tickFormat(d3.format("~s")) -->
<!-- 
  .tickValues([0, 150, 50, 600])
  .tickFormat(d3.format("~s")) -->

<!-- selectedYear = year;

  var index = averages.map(function(x) { return x.year}).indexOf(selectedYear)

  var getYear = averages.filter(function (element){
      console.log(year);
      return element.year === year;
console.log(year) -->

<!-- const results = averages.filter(obj => {
    return obj.year == 1999;
})
console.log(results) -->

<!-- function drawSelectOutcome() {
    var outcomeOptions = document.getElementById("selectOutcome");
  //   for (let i = 1999; i < 2017; i++) {
      var el = document.createElement("option");
      el.textContent = "Number Killed";
      el.value = "killed";
      outcomeOptions.appendChild(el);
  //   }
  } -->
